<div class="bckContainer"></div>
<div class="row pt-4">
  <div class="col-sm-12 mb-3">

    <!-- Make the Tab Section Common (Parent Tab)-->
    <core-tab [Tab]="tab_menu"
              (GetTabDtls)="changeTabDtls($event)"
              [customClass]="'nav'"
              ></core-tab>
    <!-- End -->
    <div [ngClass]="{'card border-0 p-3':sub_tab.length > 0 }">
    <!-- Sub Tab -->
    <ng-container *ngIf="sub_tab.length > 0">
      <core-tab [Tab]="sub_tab"
      [index]="subIndex"
      (GetTabDtls)="changeSubTab($event)"
      [customClass]="'second_tab'"></core-tab>
    </ng-container>
    <!-- End -->
    <!-- Filter -->
    <mat-card class="navCard">
      <mat-card-header class="border-bottom">
        <mat-card-title>
          Search {{title}}
        </mat-card-title>
        <div class="my-auto pr-4 d-flex align-items-center">
          <p-selectButton [(ngModel)]="btn_type"
                          [options]="filter_type"
                          optionValue="value"
                          styleClass="p-button-lg"
                          (onOptionClick)="onItemClick($event)"
                          optionLabel="icon">
            <ng-template let-item>
              <i [class]="item.icon" [matTooltip]="item.label"></i>
            </ng-template>
          </p-selectButton>

          <button mat-icon-button
                 color="primary" (click)="toggle()" class="mx-3">
            <mat-icon [ngClass]="{'rotateUp':state == 'collapsed','rotateDown':state == 'expanded'}">
              keyboard_arrow_up
            </mat-icon>
          </button>
        </div>

      </mat-card-header>
      <mat-card-content  [@bodyExpansion]="state" [ngClass]="{'expandable-content': state == 'collapsed','px-3 py-3':state == 'expanded'}">
          <ng-template #SearchBtn>
            <p-button type="submit" label="Show" icon="pi pi-eye" iconPos="right" styleClass="p-button-lg"></p-button>
          </ng-template>

          <form [formGroup]="filter" autocomplete="off" (ngSubmit)="searchInvestorReport()">
            <div class="row">
              <div class="col-sm-3">
                <label for="view_type">View By</label>
                <select class="form-control"
                        id="view_type" name="view_type"
                        formControlName="view_type">
                  <option value="">Select</option>
                  <option [value]="item.id"
                          *ngFor="let item of view_type">
                    {{item.type}}
                  </option>
                </select>
              </div>
              <div class="col-sm-3">
                <section
                class="selectAllCheckBox"
                *ngIf=" flag!= 'F' && sub_flag!='IW'">
                  <mat-checkbox color="primary" class="example-margin"
                  formControlName="is_all_client">Select All</mat-checkbox>
                </section>
                <app-core-srch [label]="filter.value.view_type == 'F' ? 'Family Head' : 'Investor' "
                              [placeholder]="'Search By' + (filter.value.view_type == 'F' ? ' Family Head ' : ' Investor ') +'Name, Code, Email, Mobile, PAN & DOB'"
                              [isPending]="__isClientPending"
                              [listItems]="__clientMst"
                              [flag]="'C'"
                              [noDataFoundTitle]="'Sorry!! No Records Found'"
                              [noDataFoundSubTitle]="'If your result match,they will appear here'"
                              [propertiesToShow]="['client_name','pan']"
                              formControlName="client_name"
                              [displayMode]="displayMode_forClient"
                              (setDisplayMode)="displayMode_forClient = $event"
                              (selectedItems)="getSelectedItemsFromParent($event)"
                              (scrollToEnd)="loadInvestorOnScrollToEnd($event)"></app-core-srch>
              </div>
              <ng-container *ngIf="filter.value.view_type == 'F'">
                <div class="col-sm-3">
                  <label for="family_members">Family Members&nbsp;
                    <ng-container *ngIf="!filter.get('family_members').disabled">
                      <i class="pi pi-info-circle" matTooltip="Search & select family head to get family members" style="font-size: 1rem" ></i>
                    </ng-container>
                  </label>
                  <ng-multiselect-dropdown
                  [id]="'family_members'"
                  [placeholder]="'Select Family Members'"
                  [settings]="settingsforFamilyMembers"
                  [data]="family_members"
                  [disabled]="filter.get('family_members').disabled"
                  formControlName="family_members">
                  </ng-multiselect-dropdown>
                </div>
            </ng-container>
              <div class="col-sm-3">
                <label for="folio_status"> Folio Status</label>
                <select class="form-control"
                        formControlName="folio_status"
                        id="folio_status"
                        name="folio_status">
                  <option value="">Select All</option>
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>

                </select>
              </div>
              <div class="col-sm-3">
                <label for="folio_no">Folio</label>
                <input type="text" name="folio_no"
                placeholder="Enter Folio Number"
                id="folio_no" class="form-control" formControlName="folio_no">
              </div>
              <ng-container [ngSwitch]="true">

                <!-- Visible Only For KYC Report (Investor Wise) && Aadhar Pan Link Report  -->
                <ng-container *ngSwitchCase="(flag == 'K' || flag == 'A') && sub_flag != 'KNV'">
                  <div class="col-sm-3">
                    <label for="kyc_status"> KYC Status</label>
                    <select class="form-control"
                            formControlName="kyc_status"
                            id="kyc_status"
                            name="kyc_status">
                      <option value="">Select All</option>
                      <option value="Y">KYC Verified</option>
                      <option value="N">KYC Not Verified</option>

                    </select>
                  </div>
                </ng-container>
                <!-- End -->

                <!-- Visible Only For Nominee Report (Investor Wise)-->
                <ng-container *ngSwitchCase="flag == 'N' && sub_flag == 'IW'">
                  <div class="col-sm-3">
                    <label for="nominee_status"> Nominee Status</label>
                    <select class="form-control"
                            formControlName="nominee_status"
                            id="nominee_status"
                            name="nominee_status">
                      <option value="">Select All</option>
                      <option value="Opt-In">Opt-In</option>
                      <option value="Opt-Out">Opt-Out</option>
                      <option value="Pending">Opt-In / Opt-Out  Pending</option>
                    </select>
                  </div>
                </ng-container>
                <!-- End -->

                <!-- Visible Only For Aadhar Pan Link Report (Investor Wise) -->
                <ng-container *ngSwitchCase="flag == 'A' && sub_flag == 'IW'">
                  <div class="col-sm-3">
                    <label for="adhaar_pan_link_status"> Adhaar PAN Link Status</label>
                    <select class="form-control"
                            formControlName="adhaar_pan_link_status"
                            id="adhaar_pan_link_status"
                            name="adhaar_pan_link_status">
                      <option value="">Select All</option>
                      <option value="Y">Linked</option>
                      <option value="N">Not Linked</option>
                      <option value="N/A">Not Applicable</option>
                    </select>
                  </div>
                </ng-container>
                <!-- End -->

              </ng-container>

              <!-- LOGIC FOR ADVANCE FILTER / Reset -->
              <ng-container *ngIf="btn_type == 'R';else advanceFilter">
                <!-- Visible only when sub_flag not equals to NL -->
                <ng-container  *ngIf="sub_flag != 'NL';else NotLinked">
                  <!-- Visible only When View By is selected as `Family Head`  -->
                  <ng-container *ngIf="filter.value.view_type == 'F';else Client">
                    <div
                    class="d-flex justify-content-end align-items-end"
                    [ngClass]="{
                        'col-sm-9':flag == 'F' || sub_flag == 'KNV' || sub_flag == 'IOP',
                        'col-sm-6':flag == 'K' || flag == 'N',
                        'col-sm-3':flag == 'A'
                    }"
                    ><ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
                  </div>
                  </ng-container>
                  <!-- End -->
                  <!-- Visible only When View By is selected as `Client`  -->
                  <ng-template #Client>
                    <div class="d-flex justify-content-end align-items-end"
                    [ngClass]="{
                    'col-sm-12 mt-3':flag == 'F' || sub_flag == 'KNV' || sub_flag == 'IOP',
                    'col-sm-9 mt-2':((flag == 'K' && sub_flag == 'IW') || (flag == 'N' && sub_flag == 'IW')),
                    'col-sm-6':flag == 'A' && sub_flag == 'IW'}"
                    >
                    <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
                    </div>
                  </ng-template>
                  <!-- End -->

                </ng-container>
                <!-- End -->
                <!-- Else Visible only when sub_flag equals to NL -->
                <ng-template #NotLinked>
                  <div class="d-flex justify-content-end align-items-end"
                  [ngClass]="{
                    'col-sm-6':  filter.value.view_type == 'F',
                    'col-sm-9':  filter.value.view_type != 'F'
                  }"
                  >
                  <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
                  </div>
                </ng-template>
                <!-- End -->
              </ng-container>
              <ng-template #advanceFilter>
                <div class="col-sm-3">
                  <label for="brn_cd">Branch</label>
                  <ng-multiselect-dropdown #multiSelect id="brn_cd"
                                          [placeholder]="'Select Branch'"
                                          [settings]="settingsforBrnchDropdown"
                                          [data]="__branchMst"
                                          formControlName="brn_cd">
                  </ng-multiselect-dropdown>
                </div>
                <div class="col-sm-3">
                  <label for="bu_type">Business Type</label>
                  <ng-multiselect-dropdown #multiSelect
                                          id="bu_type"
                                          [placeholder]="'Select Business Type'"
                                          [settings]="settingsforBuTypeDropdown" [data]="__bu_type" formControlName="bu_type_id">
                  </ng-multiselect-dropdown>
                </div>
                <div class="col-sm-3">
                  <label for="rm_name">Relationship Manager</label>
                  <ng-multiselect-dropdown #multiSelect id="rm_name" [placeholder]="'Select Relationship Manager'"
                                          [settings]="settingsforRMDropdown" [data]="__RmMst" formControlName="rm_id">
                  </ng-multiselect-dropdown>
                </div>
                <div class="col-sm-3">
                  <label for="sub_brk_cd">Sub Broker</label>
                  <ng-multiselect-dropdown #multiSelect [id]="'sub_brk_cd'" [placeholder]="'Select Sub Broker'"
                                          [settings]="settingsforSubBrkDropdown" [data]="__subbrkArnMst"
                                          formControlName="sub_brk_cd">
                  </ng-multiselect-dropdown>
                </div>
                <div class="col-sm-3">
                  <label for="euin_no">EUIN</label>
                  <ng-multiselect-dropdown #multiSelect id="euin_no" [placeholder]="'Select Employee'"
                                          [settings]="settingsforEuinDropdown" [data]="__euinMst" formControlName="euin_no">
                  </ng-multiselect-dropdown>
                </div>
                <ng-container *ngIf="filter.value.view_type == 'F';else Client">
                  <div
                  class="d-flex justify-content-end align-items-end"
                  [ngClass]="{
                  'col-sm-6':flag == 'F' || sub_flag == 'KNV' || sub_flag == 'IOP',
                  'col-sm-3':(sub_flag == 'IW' || sub_flag == 'NL') && (flag == 'K' || flag == 'N' || flag == 'A'),
                  'col-sm-12 mt-2':sub_flag == 'IW' && flag == 'A'}"
                  >
                  <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
                </div>
                </ng-container>
                <ng-template #Client>
                <ng-container *ngIf="sub_flag == 'KNV' || sub_flag == 'IOP' || sub_flag == 'NL';else OtherSubFlag">
                  <div
                  class="d-flex justify-content-end align-items-end"
                  [ngClass]="{'col-sm-9':sub_flag == 'KNV' || sub_flag == 'IOP',
                  'col-sm-6':sub_flag == 'NL'}">
                  <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
                </div>
                </ng-container>
                <ng-template #OtherSubFlag>
                  <div
                  class="d-flex justify-content-end align-items-end"
                  [ngClass]="{'col-sm-9':flag == 'F',
                  'col-sm-6':(flag == 'K' || flag == 'N'),
                  'col-sm-3':flag == 'A'}">
                  <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
                </div>
                </ng-template>
                </ng-template>
              </ng-template>
            </div>

          </form>

      </mat-card-content>
    </mat-card>
    <!-- End  -->
    </div>
    <!-- Filter -->
    <mat-card class="my-3">
      <mat-card-header>
        <mat-card-title>
          {{title}} {{index == 0 ? 'Reports' : ''}}
        </mat-card-title>
        <div class="my-auto w-25 pr-4">
          <span class="ml-auto">
            <input id="search" class="form-control rounded" type="text"
                   (input)="filterGlobal($event)"
                   placeholder="Search" />
          </span>
        </div>
      </mat-card-header>
      <mat-card-content>
          <p-table #primeTbl
                   id="trxDt"
                   [value]="report_data"
                   [responsive]="true"
                   [rowHover]="true"
                   styleClass="p-datatable-striped p-datatable-lg"
                   responsiveLayout="scroll"
                   [scrollable]="true" [scrollHeight]="'370px'"
                   [virtualScroll]="true"
                   [virtualRowHeight]="33"
                   [columns]="column"
                   [paginator]="true"
                   [autoLayout]="true"
                   [totalRecords]="report_data.length"
                   [pageLinks]="3"
                   [rowsPerPageOptions]="[10,50,100,{ showAll: 'All' }]"
                   currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                   [rows]="10"
                   [showCurrentPageReport]="true"
                   [globalFilterFields]="getColumns()"
                   [tableStyle]="{ 'min-width': tble_width }">
            <ng-template pTemplate="header">
              <tr>
                <th *ngFor="let col of column"
                    [pSortableColumn]="col.field"
                    [style.max-width]="col.width"
                    [style.min-width]="col.width">
                  {{ col.header }}
                  <p-sortIcon [field]="col.field">
                  </p-sortIcon>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-folio_dt let-i="rowIndex">
              <tr tabindex="999"
              [ngStyle]="{'background-color': folio_dt.folio_status == 'Inactive' ? '#b70a0a30' : '','height':'33px'}"
              >
                <td *ngFor="let col of column"
                    [style.max-width]="col.width"
                    [style.min-width]="col.width">
                  <ng-container [ngSwitch]="true">
                    <ng-container *ngSwitchCase="col.field == 'sl_no'">
                      <p class="m-0">{{i + 1}}</p>
                    </ng-container>

                    <ng-container *ngSwitchCase="col.field == 'dob' || col.field == 'dob_2nd_holder' ||  col.field == 'dob_3rd_holder' || col.field == 'guardian_dob' || col.field == 'folio_date'">
                      <p class="m-0">{{folio_dt[col.field] ? (folio_dt[col.field] | date:'dd-MM-YYYY') : 'N/A'}}</p>
                    </ng-container>




                    <!-- <ng-container *ngSwitchCase="col.field == 'folio_date'">
                      <p class="m-0">{{folio_dt[col.field] ?
                        (folio_dt[col.field] | date:'dd-MM-YYYY')
                        : 'N/A'}}</p>

                    </ng-container> -->

                    <ng-container *ngSwitchCase="col.field == 'scheme_name'">
                      <p class="m-0">
                        <!-- {{folio_dt['product_code']}} -  {{folio_dt['folio_no']}} -->
                        {{ folio_dt[col.field] ? (folio_dt[col.field]  + '-' + folio_dt['plan_name'] + '-' + folio_dt['option_name']) : 'N/A' }}
                      </p>
                    </ng-container>

                    <ng-container *ngSwitchCase="col.field == 'mode_of_holding'">
                      <p class="m-0">{{folio_dt[col.field] ? (folio_dt[col.field] == 'SI' ? 'Single' : 'Anyone or survivor') : 'N/A'}}</p>
                    </ng-container>
                    <ng-container *ngSwitchCase="col.field == 'sub_brk_cd'">
                      <p class="m-0">{{ (folio_dt[col.field] && (folio_dt[col.field] | titlecase)!="Not Provided" && folio_dt[col.field]!="BLANK" && folio_dt[col.field]!='0' && folio_dt[col.field]!= ' ') ? folio_dt[col.field] : 'N/A' }}</p>
                      </ng-container>
                      <ng-container *ngSwitchCase="col.field == 'pa_link_ststus_3rd' || col.field == 'pa_link_ststus_2nd' || col.field == 'guardian_pa_link_ststus'">
                        <p class="m-0">{{ (folio_dt[col.field] &&  (folio_dt[col.field] | titlecase)!="Not Provided" && folio_dt[col.field]!="BLANK"  && folio_dt[col.field]!= ' ') ? (folio_dt[col.field] | titlecase) : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'pa_link_ststus_1st'">
                        <p class="m-0">{{ (folio_dt[col.field] &&  (folio_dt[col.field] | titlecase)!="Not Provided" && folio_dt[col.field]!="BLANK"  && folio_dt[col.field]!= ' ') ? (folio_dt['pan'] ? (folio_dt[col.field] | titlecase) : 'N/A') : 'N/A' }}</p>
                      </ng-container>



                      <ng-container *ngSwitchCase="col.field == 'occupation_des' || col.field == 'occupation_des_2nd'
                      || col.field == 'occupation_des_3rd' || col.field == 'guardian_occu_des'">
                        <p class="m-0">{{ (folio_dt[col.field] && (folio_dt[col.field] | titlecase)!="Not Available" && (folio_dt[col.field] | titlecase)!="Not Provided" && folio_dt[col.field]!="BLANK"  && folio_dt[col.field]!= ' ') ? (folio_dt[col.field] | titlecase) : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'nom_relation_1' || col.field == 'nom_relation_2'
                      || col.field == 'nom_relation_3' || col.field == 'guardian_relation'">
                        <p class="m-0">{{ (folio_dt[col.field] && (folio_dt[col.field] | titlecase)!="Not Provided" && folio_dt[col.field]!="BLANK"  && folio_dt[col.field]!= ' ') ? (folio_dt[col.field] | titlecase) : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'email' || col.field == 'email_2nd_holder'
                      || col.field == 'email_3rd_holder' || col.field == 'guardian_email'">
                        <p class="m-0">{{ folio_dt[col.field]  ? (folio_dt[col.field] | lowercase) : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'nom_per_3' || col.field == 'nom_per_2' || col.field == 'nom_per_1'">
                        <p class="m-0">{{ folio_dt[col.field] && folio_dt[col.field] > 0  ? folio_dt[col.field] : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'first_client_name' || col.field == 'nom_name_1'
                      || col.field == 'nom_name_2' || col.field == 'joint_name_2'
                      ||  col.field == 'joint_name_1'
                      ||  col.field == 'nom_name_3' || col.field == 'guardian_name'">
                        <p class="m-0">{{ folio_dt[col.field] ? (folio_dt[col.field] | titlecase) : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'ckyc_no_1st' || col.field == 'ckyc_no_2nd'
                      || col.field == 'ckyc_no_3rd' || col.field == 'guardian_ckyc_no'">
                        <p class="m-0">{{ (folio_dt[col.field] && folio_dt[col.field] != 0)  ? folio_dt[col.field] : 'N/A' }}</p>
                      </ng-container>

                      <ng-container *ngSwitchCase="col.field == 'city'">
                        <p class="m-0">{{ folio_dt[col.field]   ? (folio_dt[col.field] | titlecase) : 'N/A' }}</p>
                      </ng-container>

                    <ng-container *ngSwitchCase="col.field == 'nom_optout_status'">
                        <ng-container *ngIf="folio_dt[col.field];else nonominee__Status">
                                <p class="m-0">{{folio_dt[col.field] == 'Y' ? 'Nominee Opt-out' : 'Nominee Opt-in'}}</p>
                        </ng-container>
                        <ng-template #nonominee__Status>
                          <p class="m-0">{{ folio_dt.nom_name_1  ? 'Nominee Opt-in' : 'Opt-in/Opt-out Pending'}}</p>
                        </ng-template>
                    </ng-container>

                    <ng-container *ngSwitchCase="col.field == 'folio_balance'">
                      <p class="m-0">
                        {{folio_dt[col.field] ? folio_dt[col.field] : 0}}
                      </p>

                    </ng-container>

                    <ng-container *ngSwitchDefault>
                      <p class="m-0">
                        {{ folio_dt[col.field] ? folio_dt[col.field]: 'N/A' }}
                      </p>
                    </ng-container>
                  </ng-container>
                </td>
              </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage" let-columns>
              <tr>
                <td [attr.colSpan]="columns.length" class="noHistoryAvailable">
                  <h5>No Records Found</h5>
                </td>
              </tr>
            </ng-template>
          </p-table>
      </mat-card-content>
    </mat-card>
    <!-- End  -->

  </div></div>
