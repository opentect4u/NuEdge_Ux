<div class="row flexSec">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header p-3 d-flex justify-content-between">
         <b  class="m-0 d-flex align-items-center">
           <mat-icon class="mr-2">
            search
           </mat-icon>
           Search Transaction Report
         </b>
         <p-selectButton
            [(ngModel)]="btn_type"
            [options]="selectBtn"
            optionValue="value"
            styleClass="p-button-lg"
            (onOptionClick)="onItemClick($event)"
            optionLabel="icon">
              <ng-template let-item>
                  <i [class]="item.icon"  [matTooltip]="item.label"></i>
              </ng-template>
          </p-selectButton>
      </div>
      <div class="card-body p-3">
        <ng-template #SearchBtn>
          <p-button type="submit" label="Show" icon="pi pi-eye" iconPos="right" styleClass="p-button-lg"></p-button>
        </ng-template>
      <form [formGroup]="misTrxnRpt" (ngSubmit)="searchTrxnReport()" autocomplete="off">
          <div class="row">
              <div class="col-sm-3">
                   <label for="date_periods">Periods</label>
                   <select class="form-control" formControlName="date_periods" id="date_periods" name="date_periods">
                    <option value="">Select</option>
                    <option [value]="periods.id"  *ngFor="let periods of periods_type">{{periods.periods}}</option>
                   </select>
              </div>
              <div class="col-sm-3">
                <label for="date_range">Date Range (From - To)</label>
                <p-calendar
                #dateRng
                [maxDate]="maxDate"
                [minDate]="minDate"
                dateFormat="dd/mm/yy"
                placeholder="Select Date Range"
                formControlName="date_range"
                selectionMode="range"
                [readonlyInput]="true"
                [id]="'date_range'"
                [showIcon]="true"
                [hideOnDateTimeSelect]="true"
                [showButtonBar]="true">
                </p-calendar>
           </div>
           <div class="col-sm-3">
            <label for="pan_no">Investor</label>
            <ng-multiselect-dropdown
               [id]="'pan_no'"
               [placeholder]="'Select Client'"
              [settings]="settingsforClient"
              [data]="clientMst"
              formControlName="pan_no">
            </ng-multiselect-dropdown>
             <!-- <input type="text" placeholder="Enter Investor PAN / Name"
             name="pan_no" id="pan_no" class="form-control" formControlName="pan_no"> -->
            <!-- <app-core-srch
            [label] = "'Client Details'"
            [placeholder]="'Search By Client Name,Client Code, Email, Mobile, PAN & DOB'"
            [isPending]="__isClientPending"
            [listItems] = "__clientMst"
            [flag] = "'C'"
            [noDataFoundTitle]="'Sorry!! No Records Found'"
            [noDataFoundSubTitle]="'If your result match,they will appear here'"
            [propertiesToShow] = "['client_code','pan','client_name']"
            formControlName="client_name"
            [displayMode]="displayMode_forClient"
            (setDisplayMode)="displayMode_forClient = $event"
            (selectedItems)="getSelectedItemsFromParent($event)"
            ></app-core-srch> -->
           </div>
           <div class="col-sm-3">
            <label for="amc_id">AMC</label>
            <ng-multiselect-dropdown
              [attr.id]="'amc_id'"
              [placeholder]="'Select AMC'"
              [settings]="settingsforAMCDropdown"
              [data]="amcMst"
              formControlName="amc_id">
            </ng-multiselect-dropdown>
           </div>
          </div>
          <div class="row">
            <div class="col-sm-3">
              <label for="cat_id">Category</label>
              <ng-multiselect-dropdown
               [id]="'cat_id'"
               [placeholder]="'Select Category'"
              [settings]="settingsforCatDropdown"
              [data]="catMst"
              formControlName="cat_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="sub_cat_id">Sub-Category</label>
              <ng-multiselect-dropdown
               [id]="'sub_cat_id'"
               [placeholder]="'Select Sub-Category'"
              [settings]="settingsforSubCatDropdown"
              [data]="subcatMst"
              formControlName="sub_cat_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="scheme_id">Scheme</label>
              <ng-multiselect-dropdown
               [id]="'scheme_id'"
               [placeholder]="'Select Scheme'"
              [settings]="settingsforSchemeDropdown"
              [data]="schemeMst"
              formControlName="scheme_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="trxn_type_id">Transaction Type</label>
              <ng-multiselect-dropdown
               [id]="'trxn_type_id'"
               [placeholder]="'Select Transaction Type'"
              [settings]="settingsforTrxnTypeDropdown"
              [data]="trxnTypeMst"
              formControlName="trxn_type_id">
            </ng-multiselect-dropdown>
            </div>

          </div>
          <div class="row">
            <div class="col-sm-3">
              <label for="trxn_sub_type_id">Transaction Sub-Type</label>
              <ng-multiselect-dropdown
               [id]="'trxn_sub_type_id'"
               [placeholder]="'Select Transaction Sub-Type'"
              [settings]="settingsforTrxnSubTypeDropdown"
              [data]="trxnSubTypeMst"
              formControlName="trxn_sub_type_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="folio_no">Folio No</label>
               <input type="text" name="folio_no" id="folio_no" class="form-control" placeholder="Enter Folio Number" formControlName="folio_no">
            </div>
            <ng-container *ngIf="btn_type == 'A';else normalFilter">
              <div class="col-sm-3">
                <label for="brn_cd">Branch</label>
                <ng-multiselect-dropdown #multiSelect id="brn_cd" [placeholder]="'Select Branch'"
                  [settings]="settingsforBrnchDropdown" [data]="__branchMst" formControlName="brn_cd">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3">
                <label for="bu_type">Business Type</label>
                <ng-multiselect-dropdown #multiSelect id="bu_type" [placeholder]="'Select Business Type'"
                  [settings]="settingsforBuTypeDropdown" [data]="__bu_type" formControlName="bu_type_id">
                </ng-multiselect-dropdown>
              </div>
            </ng-container>
            <ng-template #normalFilter>
              <div class="col-sm-6 d-flex align-items-end justify-content-end">
                <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
              </div>
            </ng-template>
          </div>

          <ng-container  *ngIf="btn_type == 'A'">
          <div class="row">
            <ng-container>
              <div class="col-sm-3">
                <label for="rm_name">Relationship Manager</label>
                <ng-multiselect-dropdown #multiSelect id="rm_name" [placeholder]="'Select Relationship Manager'"
                  [settings]="settingsforRMDropdown" [data]="__RmMst" formControlName="rm_id">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3">
                <label for="sub_brk_cd">Sub Broker</label>
                <ng-multiselect-dropdown #multiSelect [id]="'sub_brk_cd'" [placeholder]="'Select Sub Broker'"
                  [settings]="settingsforSubBrkDropdown" [data]="__subbrkArnMst"
                  formControlName="sub_brk_cd">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3">
                <label for="euin_no">EUIN</label>
                <ng-multiselect-dropdown #multiSelect id="euin_no" [placeholder]="'Select Employee'"
                  [settings]="settingsforEuinDropdown" [data]="__euinMst" formControlName="euin_no">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3 d-flex align-items-end justify-content-end">
                <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </form>
      </div>
    </div>


    <div class="card my-3" #tableCard>
      <div class="card-header py-1 px-3 d-flex justify-content-between">
        <b class="m-0 d-flex align-items-center"><i class="pi pi-database mr-1" style="font-size:2rem"></i>Reports</b>

        <button mat-icon-button [matTooltip]="'Close Report'" (click)="hideCard('none')">
          <mat-icon>close</mat-icon>
        </button>

      </div>
      <div class="card-body">
        <p-table
        #primeTbl
        id="trxDt"
        [value]="trxnRpt"
        [lazy]="true"
        [lazyLoadOnInit]="true"
        [responsive]="true"
        [rowHover]="true"
        styleClass="p-datatable-striped"
        [autoLayout]="true"
        [scrollable]="true"
        [resizableColumns]="true"
        columnResizeMode="expand"
        appendTo="body"
        [columns]="column"
        [paginator]="true"
        [totalRecords]="trxnRpt.length"
        [pageLinks]="3"
        [rowsPerPageOptions]="[10,50,100]"
        [rows]="10"
        [tableStyle]="{ 'min-width': '400rem' }"
        >
          <ng-template pTemplate="header">
              <tr>
                  <th pResizableColumn *ngFor="let col of column" [pSortableColumn]="col.field"
                    [style.width]="col.field == 'scheme_name' ? '34rem' : '25rem'"
                  >
                    {{ col.header }}
                    <p-sortIcon [field]="col.field">
                    </p-sortIcon>
                  </th>
              </tr>
          </ng-template>
          <ng-template pTemplate="body" let-trxn let-columns="columns"  let-i="rowIndex">
            <tr tabindex="999">
              <td *ngFor="let col of column">
                <ng-container [ngSwitch]="true">
                  <ng-container *ngSwitchCase="col.field == 'sl_no'">
                    <b>{{i + 1}}</b>
                 </ng-container>

                 <ng-container *ngSwitchCase="col.field == 'sub_brk_cd'">
                  <b>{{ trxn[col.field] && trxn[col.field]!=' ' ? trxn[col.field] : 'N/A' }}</b>
               </ng-container>

               <ng-container *ngSwitchCase="col.field == 'first_client_name'">
                <b>{{ trxn[col.field] ? (trxn[col.field] | titlecase) : 'N/A' }}</b>
             </ng-container>


                 <ng-container *ngSwitchCase="col.field == 'trans_date'">
                    <b>{{ trxn[col.field] ? (trxn[col.field] | date:'dd-MM-YYYY') : 'N/A' }}</b>
                 </ng-container>
                 <ng-container *ngSwitchCase="col.field == 'scheme_name'">
                  <b matTooltip="{{trxn[col.field] ? (trxn[col.field]  + ' - ' +  trxn['plan_name'] + ' - ' + trxn['option_name']) : ''}}">{{ trxn[col.field] ? (trxn[col.field] + '-' + trxn['plan_name'] + '-' + trxn['option_name']) : 'N/A'}}</b>
               </ng-container>
               <ng-container *ngSwitchCase="col.field == 'tds'">
                <b  matTooltip="{{(trxn[col.field] && trxn[col.field] != ' ') ? trxn[col.field] : 0}}">
                  {{ (trxn[col.field] && trxn[col.field] != " ") ? trxn[col.field] : 0}}
                </b>
             </ng-container>
                 <ng-container *ngSwitchCase="col.field == 'amount' || col.field == 'pur_price'">
                  <b [matTooltip]="trxn[col.field]">{{ trxn[col.field] ? (trxn[col.field] | currency:'INR') : 'N/A' }}</b>
               </ng-container>
                  <ng-container *ngSwitchDefault>
                    <b [matTooltip]="trxn[col.field]">{{ trxn[col.field] ? trxn[col.field] : 'N/A' }}</b>
                  </ng-container>
                </ng-container>
              </td>
              </tr>
            </ng-template>

          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
              <td [attr.colSpan]="columns.length" class="noHistoryAvailable">
                 No Records Found
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="footer">
            <tr  *ngIf="misTrxnRpt.value.pan_no">
              <td  *ngFor="let col of column">
                <ng-container [ngSwitch]="true">
                  <ng-container *ngSwitchCase="col.field == 'sl_no'">
                   Total
                 </ng-container>
                 <ng-container *ngSwitchCase="col.field == 'amount'">
                 {{total?.net_amt | currency: 'INR'}}
                  </ng-container>
                   <ng-container *ngSwitchCase="col.field == 'gross_amount'">
                   {{total?.gross_amt | currency: 'INR'}}
                   </ng-container>
                  <ng-container *ngSwitchCase="col.field == 'tds'">
                   {{total?.tds | currency: 'INR'}}
                </ng-container>
                <ng-container *ngSwitchCase="col.field == 'stamp_duty'">
               {{total?.stamp_duity | currency: 'INR'}}
              </ng-container>
                  </ng-container>
              </td>
           </tr>
          </ng-template>
      </p-table>

      </div>
      <div class="card-footer">
        <b>
          In Total There Are {{trxnRpt.length}} Transaction
        </b>
      </div>

    </div>

  </div>
</div>
