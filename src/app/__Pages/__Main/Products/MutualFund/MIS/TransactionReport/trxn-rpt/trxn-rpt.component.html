<div class="row flexSec">
  <div class="col-sm-12">
    <div class="card">
      <div class="card-header p-3 d-flex justify-content-between">
         <b  class="m-0 d-flex align-items-center">
           <mat-icon class="mr-2">
            search
           </mat-icon>
           Search Transaction Report
         </b>
         <p-selectButton
            [(ngModel)]="btn_type"
            [options]="selectBtn"
            optionValue="value"
            styleClass="p-button-lg"
            (onOptionClick)="onItemClick($event)"
            optionLabel="icon">
              <ng-template let-item>
                  <i [class]="item.icon"  [matTooltip]="item.label"></i>
              </ng-template>
          </p-selectButton>
      </div>
      <div class="card-body p-3">
        <ng-template #SearchBtn>
          <p-button type="submit" label="Show" icon="pi pi-eye" iconPos="right" styleClass="p-button-lg"></p-button>
        </ng-template>
      <form [formGroup]="misTrxnRpt" (ngSubmit)="searchTrxnReport()" autocomplete="off">
          <div class="row">
              <div class="col-sm-3">
                   <label for="date_periods">Periods</label>
                   <select class="form-control" formControlName="date_periods" id="date_periods" name="date_periods">
                    <option value="">Select All</option>
                    <option [value]="periods.id"  *ngFor="let periods of periods_type">{{periods.periods}}</option>
                   </select>
              </div>
              <div class="col-sm-3">
                <label for="date_range">Date Range (From - To)</label>
                <p-calendar
                #dateRng
                [maxDate]="maxDate"
                [minDate]="minDate"
                dateFormat="dd/mm/yy"
                placeholder="Select Date Range"
                formControlName="date_range"
                selectionMode="range"
                [readonlyInput]="true"
                [id]="'date_range'"
                [showIcon]="true"
                [hideOnDateTimeSelect]="true"
                [showButtonBar]="true">
                </p-calendar>
           </div>
            <div class="col-sm-3">
              <label for="client_type">View Type</label>
              <select name="client_type"
              id="client_type"
              class="form-control"
              formControlName="view_type">
               <option value="">Select</option>
               <option value="C">Client</option>
               <option value="F">Family</option>
              </select>
            </div>

           <div class="col-sm-3">
            <!-- <div class="d-flex justify-content-between align-items-center"> -->
              <!-- <label for="pan_no">Investor</label> -->
              <!-- <p-button label="Load Investor" styleClass="p-button-link" (click)="loadInvestor()"></p-button> -->
            <!-- </div> -->
            <!-- <ng-multiselect-dropdown
               [id]="'pan_no'"
               [placeholder]="'Select Investor'"
              [settings]="settingsforClient"
              [data]="clientMst"
              formControlName="pan_no">
            </ng-multiselect-dropdown> -->
            <app-core-srch
            [label] = "'Investor'"
            [placeholder]="'Search By Investor Name, Code, Email, Mobile, PAN & DOB'"
            [isPending]="__isClientPending"
            [listItems] = "__clientMst"
            [flag] = "'C'"
            [noDataFoundTitle]="'Sorry!! No Records Found'"
            [noDataFoundSubTitle]="'If your result match,they will appear here'"
            [propertiesToShow] = "['first_client_name','first_client_pan']"
            formControlName="client_name"
            [displayMode]="displayMode_forClient"
            (setDisplayMode)="displayMode_forClient = $event"
            (selectedItems)="getSelectedItemsFromParent($event)"
            (scrollToEnd) = "loadInvestorOnScrollToEnd($event)"
            ></app-core-srch>
           </div>

          </div>
          <div class="row">
            <div class="col-sm-3">
              <label for="amc_id">AMC</label>
              <ng-multiselect-dropdown
                [attr.id]="'amc_id'"
                [placeholder]="'Select AMC'"
                [settings]="settingsforAMCDropdown"
                (onDeSelect)="onAmcDeSelect($event)"
                [data]="amcMst"
                formControlName="amc_id">
              </ng-multiselect-dropdown>
             </div>
            <div class="col-sm-3">
              <label for="cat_id">Category</label>
              <ng-multiselect-dropdown
               [id]="'cat_id'"
               [placeholder]="'Select Category'"
              [settings]="settingsforCatDropdown"
              (onDeSelect)="onCatDeSelect($event)"
              [data]="catMst"
              formControlName="cat_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="sub_cat_id">Sub-Category</label>
              <ng-multiselect-dropdown
               [id]="'sub_cat_id'"
               [placeholder]="'Select Sub-Category'"
              [settings]="settingsforSubCatDropdown"
              (onDeSelect)="onSubCatDeSelect($event)"
              [data]="subcatMst"
              formControlName="sub_cat_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="scheme_id">Scheme</label>
              <ng-multiselect-dropdown
               [id]="'scheme_id'"
               [placeholder]="'Select Scheme'"
              [settings]="settingsforSchemeDropdown"
              [data]="schemeMst"
              formControlName="scheme_id">
            </ng-multiselect-dropdown>
            </div>


          </div>
          <div class="row">
            <div class="col-sm-3">
              <label for="trxn_type_id">Transaction Type</label>
              <ng-multiselect-dropdown
               [id]="'trxn_type_id'"
               [placeholder]="'Select Transaction Type'"
              [settings]="settingsforTrxnTypeDropdown"
              (onDeSelect)="onTrxnTypeDeSelect($event)"
              [data]="trxnTypeMst"
              formControlName="trxn_type_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="trxn_sub_type_id">Transaction Sub-Type</label>
              <ng-multiselect-dropdown
               [id]="'trxn_sub_type_id'"
               [placeholder]="'Select Transaction Sub-Type'"
              [settings]="settingsforTrxnSubTypeDropdown"
              [data]="trxnSubTypeMst"
              formControlName="trxn_sub_type_id">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="folio_no">Folio No</label>
               <input type="text" name="folio_no" id="folio_no" class="form-control" placeholder="Enter Folio Number" formControlName="folio_no">
            </div>
            <ng-container *ngIf="btn_type == 'A';else normalFilter">
              <div class="col-sm-3">
                <label for="brn_cd">Branch</label>
                <ng-multiselect-dropdown #multiSelect id="brn_cd" [placeholder]="'Select Branch'"
                (onDeSelect)="onbrnCdDeSelect($event)"
                  [settings]="settingsforBrnchDropdown" [data]="__branchMst" formControlName="brn_cd">
                </ng-multiselect-dropdown>
              </div>

            </ng-container>
            <ng-template #normalFilter>
              <div class="col-sm-3 d-flex align-items-end justify-content-end">
                <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
              </div>
            </ng-template>
          </div>

          <ng-container  *ngIf="btn_type == 'A'">
          <div class="row">
            <ng-container>
              <div class="col-sm-3">
                <label for="bu_type">Business Type</label>
                <ng-multiselect-dropdown #multiSelect id="bu_type" [placeholder]="'Select Business Type'"
                (onDeSelect)="onbuTypeDeSelect($event)"
                  [settings]="settingsforBuTypeDropdown" [data]="__bu_type" formControlName="bu_type_id">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3">
                <label for="rm_name">Relationship Manager</label>
                <ng-multiselect-dropdown #multiSelect id="rm_name" [placeholder]="'Select Relationship Manager'"
                (onDeSelect)="onRmDeSelect($event)"
                [settings]="settingsforRMDropdown" [data]="__RmMst" formControlName="rm_id">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3">
                <label for="sub_brk_cd">Sub Broker</label>
                <ng-multiselect-dropdown #multiSelect [id]="'sub_brk_cd'" [placeholder]="'Select Sub Broker'"
                (onDeSelect)="onSubBrkDeSelect($event)"
                  [settings]="settingsforSubBrkDropdown" [data]="__subbrkArnMst"
                  formControlName="sub_brk_cd">
                </ng-multiselect-dropdown>
              </div>
              <div class="col-sm-3">
                <label for="euin_no">EUIN</label>
                <ng-multiselect-dropdown #multiSelect id="euin_no" [placeholder]="'Select Employee'"
                  [settings]="settingsforEuinDropdown" [data]="__euinMst" formControlName="euin_no">
                </ng-multiselect-dropdown>
              </div>

            </ng-container>
          </div>
          <div class="row mt-2">
            <div class="col-sm-12 d-flex align-items-end justify-content-end">
                <ng-container [ngTemplateOutlet]="SearchBtn"></ng-container>
            </div>
          </div>
        </ng-container>
      </form>
      </div>
    </div>


    <div class="card my-3" #tableCard>
      <div class="card-header sticky-header py-1 px-3 d-flex justify-content-between">
        <b class="m-0 d-flex align-items-center"><i class="pi pi-database mr-1" style="font-size:2rem"></i>Reports</b>

        <div class="flex w-25">
          <span class="ml-auto">
              <input id="search" class="form-control rounded" type="text"
              (input)="filterGlobal($event)"
              placeholder="search"
               />
          </span>
      </div>

      </div>
      <div class="card-body">
        <!-- [autoLayout]="true" -->

        <p-table
        #primeTbl
        id="trxDt"
        [value]="trxnRpt"
        [responsive]="true"
        [rowHover]="true"
        styleClass="p-datatable-striped p-datatable-lg"
        responsiveLayout="scroll"
        [scrollable]="true"
        [columns]="column"
        [paginator]="true"
        [autoLayout]="true"
        [totalRecords]="trxnRpt.length"
        [pageLinks]="3"
        [rowsPerPageOptions]="[10,50,100,{ showAll: 'All' }]"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
        [rows]="10"
        [showCurrentPageReport]="true"
        [globalFilterFields]="getColumns()"
        [tableStyle]="{ 'min-width': '350rem' }"
        >
          <ng-template pTemplate="header">
              <tr >
                  <th  *ngFor="let col of column"
                  [pSortableColumn]="col.field"
                  [style.max-width]="col.width"
                  [style.min-width]="(col.field != 'amc_name' && col.field != 'scheme_name') ? col.width : '12rem'"

                  >
                    {{ col.header }}
                    <p-sortIcon [field]="col.field">
                    </p-sortIcon>
                  </th>
              </tr>
          </ng-template>
          <ng-template pTemplate="body" let-trxn  let-i="rowIndex">
            <tr tabindex="999" [ngStyle]="{'background-color': trxn.transaction_subtype.includes('Rejection') ?  '#b70a0a30' : ''}">
              <td *ngFor="let col of column"
              [style.max-width]="col.width"
              [style.min-width]="(col.field != 'amc_name' && col.field != 'scheme_name') ? col.width : '12rem'"
              >
                <ng-container [ngSwitch]="true">
                  <ng-container *ngSwitchCase="col.field == 'sl_no'">
                    <b>
                      {{i + 1}}
                    </b>
                 </ng-container>

                 <ng-container *ngSwitchCase="col.field == 'sub_brk_cd'">
                  <b>{{(trxn[col.field] && trxn[col.field]!=' ' && (trxn[col.field] | uppercase)!='NOT PROVID' && trxn[col.field] != '0')  ? trxn[col.field] : 'N/A' }}</b>
               </ng-container>

               <ng-container *ngSwitchCase="col.field == 'first_client_name'">
                <b>{{ trxn[col.field] ? (trxn[col.field] | titlecase) : 'N/A' }}</b>
             </ng-container>


                 <ng-container *ngSwitchCase="col.field == 'trans_date'">
                    <b>{{ trxn[col.field] ? (trxn[col.field] | date:'dd-MM-YYYY') : 'N/A' }}</b>
                 </ng-container>
                 <ng-container *ngSwitchCase="col.field == 'scheme_name'">
                  <b matTooltip="{{trxn[col.field] ? (trxn[col.field]  + ' - ' +  trxn['plan_name'] + ' - ' + (trxn['divi_lock_flag'] == 'L' ? 'IDCW Reinvestment' : trxn['option_name'])) : ''}}">
                    {{ trxn[col.field] ? (trxn[col.field] + '-' + trxn['plan_name'] + '-' +
                    (trxn['divi_lock_flag'] == 'L' ? 'IDCW Reinvestment' : trxn['option_name']))
                    : 'N/A'
                  }}</b>
               </ng-container>
               <ng-container *ngSwitchCase="col.field == 'tot_tds'">
                <b matTooltip="{{(trxn[col.field] && trxn[col.field] != ' ') ? trxn[col.field] : 0}}">
                  {{ (trxn[col.field] && trxn[col.field] != " ") ? trxn[col.field] : 0}}
                </b>
               </ng-container>
             <ng-container *ngSwitchCase="col.field == 'remarks'">
                <b [matTooltip]="trxn[col.field]">{{trxn['remarks'] ? (trxn['remarks'] | ellipsis:30): 'N/A'}}</b>
             </ng-container>
                  <ng-container *ngSwitchDefault>
                    <b [matTooltip]="trxn[col.field]">{{ trxn[col.field] ? trxn[col.field] : 'N/A' }}</b>
                  </ng-container>
                </ng-container>
              </td>
              </tr>
            </ng-template>

          <ng-template pTemplate="emptymessage" let-columns>
            <tr>
              <td [attr.colSpan]="columns.length" class="noHistoryAvailable">
                 <h5>No Records Found</h5>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="footer">
            <tr  *ngIf="misTrxnRpt.value.pan_no" >
              <td  *ngFor="let col of column"
              [style.min-width]="(col.field != 'amc_name' && col.field != 'scheme_name') ? col.width : '12rem'"
              [style.max-width]="col.width">
                <ng-container [ngSwitch]="true">
                  <ng-container *ngSwitchCase="col.field == 'sl_no'">
                   Total
                 </ng-container>
                 <ng-container *ngSwitchCase="col.field == 'tot_amount'">
                 {{total?.net_amt | number:'1.2-2'}}
                  </ng-container>
                   <ng-container *ngSwitchCase="col.field == 'tot_gross_amount'">
                   {{total?.gross_amt | number:'1.2-2'}}
                   </ng-container>
                  <ng-container *ngSwitchCase="col.field == 'tot_tds'">
                   {{total?.tds | number:'1.2-2'}}
                </ng-container>
                <ng-container *ngSwitchCase="col.field == 'tot_stamp_duty'">
               {{total?.stamp_duity | number:'1.2-2'}}
              </ng-container>
                  </ng-container>
              </td>
           </tr>
          </ng-template>
      </p-table>

      </div>
      <div class="card-footer">
        <b>
          In Total There Are {{trxnRpt.length}} Transaction
        </b>
      </div>

    </div>

  </div>
</div>

