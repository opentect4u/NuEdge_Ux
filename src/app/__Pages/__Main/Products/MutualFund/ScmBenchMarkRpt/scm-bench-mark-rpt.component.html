<div class="bckContainer"></div>

<div class="row flexSec">
  <div class="col-sm-12">
   <!-- <div class="card">
      <div class="card-header">
        <b  class="m-0 d-flex align-items-center">
          Scheme Benchmark Report
        </b>
      </div>
      <div class="card-body p-3"> -->
        <mat-card>
          <mat-card-header class="border_bottom">
            <mat-card-title>Scheme Benchmark</mat-card-title>
            <button mat-button
                    class="my-auto"
                    color="primary" (click)="toggle()" class="mx-3">

              EXPAND {{state == 'collapsed' ? ' MORE' : ' LESS'}}

              <mat-icon [ngClass]="{'rotateUp':state == 'collapsed','rotateDown':state == 'expanded'}">
                keyboard_arrow_up
              </mat-icon>
            </button>
          </mat-card-header>
        <mat-card-content  [@bodyExpansion]="state" [ngClass]="{'expandable-content': state == 'collapsed','px-3 py-3':state == 'expanded'}">
        <form [formGroup]="scmbenchmarkFrm" autocomplete="off" (ngSubmit)="getschemebenchmarkReport()">

           <div class="row">
            <div class="col-sm-3">
                <label for="ex_id">Exchange <span class="text-danger">*</span></label>
                <select class="form-control" id="ex_id" name="ex_id" formControlName="ex_id">
                  <option value="">Select</option>
                  <option [value]="item.id" *ngFor="let item of exchangeMstDt">{{item.ex_name}}</option>
                </select>
            </div>
            <div class="col-sm-3">
              <label for="benchmark">Benchmark <span class="text-danger">*</span></label>
              <ng-multiselect-dropdown
               [id]="'benchmark'"
               [placeholder]="'Select Benchmark'"
              [settings]="settings"
              [data]="benchmark"
              formControlName="benchmark">
            </ng-multiselect-dropdown>
            </div>
            <div class="col-sm-3">
              <label for="date_periods">Periods <span class="text-danger">*</span></label>
              <select class="form-control" formControlName="date_periods" id="date_periods" name="date_periods">
               <option value="">Select</option>
               <option [value]="periods.id"  *ngFor="let periods of periods_type">{{periods.periods}}</option>
              </select>
            </div>
            <ng-container *ngIf="(
              (scmbenchmarkFrm.getRawValue().date_periods == 'D'
              || scmbenchmarkFrm.getRawValue().date_periods == 'F'
              || scmbenchmarkFrm.getRawValue().date_periods == 'W')
            );else month_year">

              <div class="col-sm-3">
                <label for="date_range">Date Range (From - To) <span class="text-danger">*</span></label>
                <p-calendar
                #dateRng
                [maxDate]="maxDate"
                [minDate]="minDate"
                dateFormat="dd/mm/yy"
                placeholder="Select Date Range"
                formControlName="date_range"
                selectionMode="range"
                [readonlyInput]="true"
                [id]="'date_range'"
                [showIcon]="true"
                (onSelect)="setEndDate()"
                [showButtonBar]="true">
                </p-calendar>
              </div>
            </ng-container>
            <ng-template #month_year>
              <ng-container
              *ngIf="scmbenchmarkFrm.getRawValue().date_periods != ''">
              <div class="col-sm-3">
              <label for="date_range">
                {{scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'Month & Years' : 'Year' }} <span class="text-danger">*</span>
              </label>
              <p-calendar
              #MYCalendar
              [view]="scmbenchmarkFrm.getRawValue().date_periods == 'M'  ?'month' :  'year' "
              [dateFormat]="scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'mm/yy' :  'yy' "
              [readonlyInput]="true"
              [maxDate]="maxDate"
              inputId="pickmonth"
              selectionMode="range"
              (onSelect)="setEndDateFormonthly_yearly()"
              formControlName="month"
              [showButtonBar]="true"
              [placeholder]="scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'MM-YYYY - MM-YYYY' : 'YYYY - YYYY' ">
            </p-calendar>
             </div>
            </ng-container>
            </ng-template>




            <div class="col-sm-12 mt-2">
              <p-button label="Serach"
              [disabled]="scmbenchmarkFrm.invalid"
              type="submit" icon="pi pi-search" iconPos="left" class="float-right"></p-button>
            </div>
           </div>

        </form>
      </mat-card-content>
      </mat-card>
        <!-- </div>
   </div> -->
   <!--<div class="card my-3">
      <div class="card-header sticky-header py-1 px-3 d-flex flex-column">
        <div class="w-100 d-flex justify-content-between align-items-center">
        <b class="m-0 d-flex align-items-center">
          <i class="pi pi-database mr-1" style="font-size:2rem"></i>Reports</b>
        <div class="flex w-25">
          <span class="ml-auto">
              <input id="search" class="form-control rounded" type="text"
              (input)="filterGlobal($event)"
              placeholder="Search"
               />
          </span>
        </div>
       </div>
        <small *ngIf="scmbrnchMstDt.length > 0">
          Period :
          <ng-container *ngIf="scmbenchmarkFrm.getRawValue().date_periods == 'D';else other">
                 {{scmbenchmarkFrm.getRawValue().date_range[0] | date:'dd-MMM-YYYY'}} -  {{scmbenchmarkFrm.getRawValue().date_range[1] | date:'dd-MMM-YYYY'}}
          </ng-container>
          <ng-template #other>
                 {{scmbenchmarkFrm.getRawValue().month[0] | date:scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'MMM-YYYY' : 'YYYY'}} -  {{scmbenchmarkFrm.getRawValue().month[1] | date:scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'MMM-YYYY' : 'YYYY'}}
          </ng-template>
        </small>

      </div>
    <div class="card-body">-->
        <mat-card class="my-4">
          <mat-card-header>
            <mat-card-title>
              <i class="pi pi-database mr-1" style="font-size:2rem"></i>Scheme Benchmark Reports
              <br/>
              <span *ngIf="scmbrnchMstDt.length > 0">
                Period :
                <ng-container *ngIf="scmbenchmarkFrm.getRawValue().date_periods == 'D';else other">
                  {{scmbenchmarkFrm.getRawValue().date_range[0] | date:'dd-MMM-YYYY'}} -  {{scmbenchmarkFrm.getRawValue().date_range[1] | date:'dd-MMM-YYYY'}}
                </ng-container>
                <ng-template #other>
                  {{scmbenchmarkFrm.getRawValue().month[0] | date:scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'MMM-YYYY' : 'YYYY'}} -  {{scmbenchmarkFrm.getRawValue().month[1] | date:scmbenchmarkFrm.getRawValue().date_periods == 'M' ? 'MMM-YYYY' : 'YYYY'}}
                </ng-template>
              </span>
            </mat-card-title>
            <!--<mat-card-subtitle *ngIf="scmbrnchMstDt.length > 0">

            </mat-card-subtitle>-->
            <div class="my-auto w-25 pr-4">
              <span class="ml-auto">
                <input id="search" class="form-control rounded" type="text"
                       (input)="filterGlobal($event)"
                       placeholder="Search" />
              </span>
            </div>
          </mat-card-header>
           <mat-card-content >
               <p-table #primeTbl
                  id="trxDt"
                  [value]="scmbrnchMstDt"
                  [responsive]="true"
                  [rowHover]="true"
                  styleClass="p-datatable-striped p-datatable-md"
                  responsiveLayout="scroll"
                  [scrollable]="true"
                  [columns]="column"
                  [paginator]="true"
                  [autoLayout]="true"
                  [totalRecords]="scmbrnchMstDt.length"
                  [pageLinks]="3"
                  [rowsPerPageOptions]="[10,200,500,{ showAll: 'All' }]"
                  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                  [rows]="10"
                  [showCurrentPageReport]="true"
                  [globalFilterFields]="getColumns()"
                  [tableStyle]="{ 'min-width': '100rem' }">
           <ng-template pTemplate="header">
             <tr>
               <th [pSortableColumn]="col.field"
                   *ngFor="let col of column"
                   [style.max-width]="col.width">
                 {{ col.header }}
                 <p-sortIcon>
                 </p-sortIcon>
               </th>
             </tr>
           </ng-template>
           <ng-template pTemplate="body" let-scmBenchmark let-i="rowIndex">
             <tr tabindex="999">
               <td *ngFor="let col of column"
                   [style.max-width]="col.width">
                 <ng-container [ngSwitch]="true">
                   <ng-container *ngSwitchCase="col.field == 'sl_no'">
                     <p class="m-0">{{i + 1}}</p>
                   </ng-container>
                   <ng-container *ngSwitchCase="col.field == 'date'">
                     <p class="m-0">{{scmBenchmark[col.field] ? (scmBenchmark[col.field] | date:'dd-MM-YYYY') : 'N/A'}}</p>
                   </ng-container>
                   <ng-container *ngSwitchCase="col.field == 'change_price'">
                     <p class='m-0 d-flex align-items-center'>
                       {{scmBenchmark[col.field]}}
                       <mat-icon style="font-size:25px!important"
                                 [ngClass]="{
                  'text-danger':scmBenchmark[col.field].includes('-'),
                  'text-success':!scmBenchmark[col.field].includes('-')
                }">
                         {{scmBenchmark[col.field].includes('-') ? 'arrow_drop_down' : 'arrow_drop_up'}}
                       </mat-icon>
                     </p>
                   </ng-container>
                   <ng-container *ngSwitchCase="col.field == 'change_percentage'">
                     <p class="m-0">
                       {{
scmBenchmark.change_percentage?.toString().includes('-') ?
                  scmBenchmark.change_percentage?.replace('-','')
                  : scmBenchmark.change_percentage
                       }}%
                     </p>
                   </ng-container>
                   <ng-container *ngSwitchDefault>
                     <p class="m-0" [matTooltip]="scmBenchmark[col.field]">
                       {{ scmBenchmark[col.field] ? scmBenchmark[col.field] : 'N/A' }}
                     </p>
                   </ng-container>
                 </ng-container>
               </td>
             </tr>
           </ng-template>
           <ng-template pTemplate="emptymessage" let-columns>
             <tr>
               <td [attr.colSpan]="columns.length" class="noHistoryAvailable">
                 <h5>No Records Found</h5>
               </td>
             </tr>
           </ng-template>
         </p-table>
           </mat-card-content>
        </mat-card>
    <!--</div>
    <div class="card-footer">
      <b>In There Total {{scmbrnchMstDt.length}} Rows</b>
    </div>

   </div>-->
  </div>
</div>
